<!doctype html>
<html lang="en">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1"/>
    <meta property="og:url" content="https://whiley.org/2012/05/28/illustrating-compile-time-verification-in-whiley/"/>
    <title>Whiley
      
      (Illustrating Compile-Time Verification in Whiley)
      
    </title>
    <script type="text/javascript" src="js/ace.js" charset="utf-8"></script>
    <script type="text/javascript" src="js/mode-whiley.js" charset="utf-8"></script>    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">    
    <link rel="stylesheet" href="https://whiley.org/css/page.css">
    <link rel="stylesheet" href="https://whiley.org/css/menu.css">
    <link rel="stylesheet" href="https://whiley.org/css/style.css">
    <link rel="stylesheet" href="https://whiley.org/css/whiley.css">    
  </head>
  <body>
    <script>
      "use strict";
      function clearMenu() {
        var q = window.matchMedia("(max-width: 992px)");
        if(q.matches) {
            var c = document.getElementById("menu-content");
            var m = document.getElementById("menu");
            c.style.display = 'none';
            m.style.filter = '';     
	}
      }      
      function toggleMenu() {
        var q = window.matchMedia("(max-width: 992px)");
        if(q.matches) {
          var c = document.getElementById("menu-content");
          var m = document.getElementById("menu");
          if(c.style.display === 'block') {
            c.style.display = 'none';
            m.style.filter = '';     
          } else {
            c.style.display = 'block';
            m.style.filter = "brightness(0.8)";
          }
	}
      }
      function toggleList(element) {
	  element.style.display="none";
	  var parent = element.parentNode;
	  var items = parent.childNodes;
	  for(var i=0;i<items.length;++i) {
	      var item = items[i];
	      if(item.classList && item.classList.contains("hidden")) {
		  if(item.style.display === 'block') {
		      item.style.display="none";
		  } else {
		      item.style.display="block";
		  }
	      }
	}
      }
    </script>        
    <div class="page">
    <header class="topbar">
      <div class="topbar-title"><a href="https://whiley.org/"><div class="logo">Wy</div></a></div>
      <div class="topbar-sep"></div>
      <div class="topbar-menu">
	<div id="menu" onclick="toggleMenu()">
	  <div id="menu-icon"><img src="https://whiley.org/images/menu.png" alt="Menu"/></div>	  
	  <div id="menu-content">
	    
	    
	    
	    
	    <a href="https://whiley.org/news/">News</a>
	    
	    
	    
	    
	    
	    <a href="https://whiley.org/install/">Install</a>
	    
	    
	    
	    
	    
	    <a href="https://whiley.org/learn/">Learn</a>
	    
	    
	    
	    
	    
	    <a href="http://whileylabs.com">Playground</a>	    
	    
	    
	    
	  </div>
	</div>	
      </div>
    </header>
    <div class="container">
      <div class="content">
	
<h1 class="post-title">Illustrating Compile-Time Verification in Whiley</h1>
<div class="post-date">
  Monday, May
  28th,
  2012      
</div>
<hr/>
<p>With the <a href="http://whiley.org/2012/05/25/whiley-v0-3-15-released/">latest release of Whiley</a>, compile-time checking of constraints can be enabled with a command-line switch.  So, I thought a few examples of this were in order.</p>
<h2 id="example-absolute-of-an-integer">Example: Absolute of an Integer</h2>
<p>Consider this simple program:</p>
<pre><code class="language-whiley" data-lang="whiley">type nat is (int x) where x &gt;= 0

function abs(int x) -&gt; nat:
    return x
</code></pre><p>This defines a type <code>nat</code> which is an <code>int</code> whose values are non-negative.  The function abs<code>(int)</code> accepts an <code>int</code> and returns a <code>nat</code>.  However, it contains a bug because <code>int</code> does not subtype <code>nat</code> (since <code>int</code> includes negatives whilst <code>nat</code> does not).  We can compile this on the command-line like so:</p>
<pre><code class="language-%" data-lang="%">./example.whiley:4: constraint not satisfied
    return x
    ^^^^^^^^
</code></pre><p>The command-line switch <code>-X verification:enable=true</code> turns on compile-time verification.  This is not enabled by default because it is experimental.  As we can see, the compiler has correctly spotted the error on line 4.  We can fix the code like so:</p>
<pre><code class="language-whiley" data-lang="whiley">type nat is (int x) where x &gt;= 0

function abs(int x) -&gt; nat:
    if x &gt;= 0
        return x
    else:
        return -x
</code></pre><p>This will now compile correctly with verification enabled.  As you can see the verifier is able to correctly reason about the effect of conditional statements.</p>
<h2 id="example-maximum-of-two-integers">Example: Maximum of two Integers</h2>
<p>As another illustration, consider the following (broken) implementation of the <code>max(int,int)</code> function:</p>
<pre><code class="language-whiley" data-lang="whiley">function max(int x, int y) -&gt; int:
    if x &lt; y:
        return x
    else:
        return y
</code></pre><p>At this point, the function does the <em>opposite</em> of what you would expect (i.e. it computes the minimum of <code>x</code> and <code>y</code> because of a bug).  However, the function will compile with verification enabled because the code meets the given specification.  Let us improve the specification a little by introducing some constraints:</p>
<pre><code class="language-whiley" data-lang="whiley">function max(int x, int y) -&gt; (int r)
ensures r == x || r == y:
    if x &lt; y:
        return x
    else:
        return y
</code></pre><p>The given constraint states the return value <code>r</code> is equal to either <code>x</code> or <code>y</code>.  However, this constraint is not strong enough to enforce that the maximum of <code>x</code> and <code>y</code> is returned.  Hence, the code still compiles even with verification enabled.  Finally, we add the missing bit:</p>
<pre><code class="language-whiley" data-lang="whiley">function max(int x, int y) -&gt; (int r)
ensures (r == x || r == y) &amp;&amp; x &lt;= r &amp;&amp; y &lt;= r:
    if x &lt; y:
        return x
    else:
        return y
</code></pre><p>Compiling the above with verification enabled now gives the following error:</p>
<pre><code class="language-%" data-lang="%">./max.whiley:3: postcondition not satisfied
        return x
        ^^^^^^^^
</code></pre><p>At this point, we can fix the bug by changing the condition to be <code>if x &gt; y</code> and it will compile correctly with verification enabled.</p>

<hr/>


      </div>
    </div>
    </div>
    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-5582165-5', 'auto');
	
	ga('send', 'pageview');
}
</script>
    
  </body>
</html>
